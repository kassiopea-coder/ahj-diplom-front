!function(){var e={903:function(){const e="üòÄ üòÅ üòÇ üòÉ üòÑ ü§£ üòÖ üòÜ üòá üòâ üòä üôÇ üôÉ üòã üòå üòç ü•∞ üòò üòó üòô üòö ü§™ üòú üòù üòõ ü§ë üò∂ üò° üò± üò® üò∞ üò¢ üò• üëç üëé".split(" ");if(document){const t=document.getElementById("emoji-btn"),s=document.getElementsByTagName("aside")[0],i=document.getElementById("emoji-container");e.forEach((e=>{const t=document.createElement("div");t.innerHTML=e,t.classList.add("emoji"),t.addEventListener("click",(e=>{const t=document.getElementById("input");t&&(t.value+=e.target.innerHTML)})),i.appendChild(t)})),t.addEventListener("click",(()=>{s.classList.toggle("hidden")}))}},233:function(e,t,s){e.exports=s.p+"background.jpg"},808:function(e,t,s){e.exports=s.p+"check-ok.png"},700:function(e,t,s){e.exports=s.p+"clip.png"},453:function(e,t,s){e.exports=s.p+"cross.png"},47:function(e,t,s){e.exports=s.p+"download.png"},382:function(e,t,s){e.exports=s.p+"geo.png"},10:function(e,t,s){e.exports=s.p+"pencil.png"},548:function(e,t,s){e.exports=s.p+"phone.png"},536:function(e,t,s){e.exports=s.p+"smail.png"},441:function(e,t,s){e.exports=s.p+"video.png"}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e}(),function(){"use strict";s(453),s(10),s(808),s(548),s(441),s(700),s(47),s(382),s(536),s(233);const e=document.querySelector(".container"),t=new class{constructor(e){this.type="",this.result=!1,this.callback=()=>{},this.init(),this.container=e}init(){"undefined"!=typeof document&&(this.elPopup=document.createElement("div"),this.elPopup.className="popup hidden",this.elPopup.innerHTML='\n    <p class="popup-header"></p>\n    <p class="popup-msg"></p>\n    <div class="popup-buttons">\n      <div class="popup-ok popup-btn">OK</div>\n    </div>\n    ',document.body.appendChild(this.elPopup),this.elPopupHeader=document.querySelector(".popup-header"),this.elPopupMsg=document.querySelector(".popup-msg"),this.btnOk=document.querySelector(".popup-ok")),this.btnOk.addEventListener("click",(()=>{this.callback(),this.closePopup(),this.callback=()=>{}}))}showPopup(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};this.type=e,this.elPopup.classList.remove("hidden"),this.elPopupHeader.innerText=t,this.elPopupMsg.innerText=s,this.callback=i,this.type,this.container.classList.add("blocked")}closePopup(){this.elPopup.classList.add("hidden"),this.elPopupHeader.innerText=null,this.elPopupMsg.innerText=null,this.container.classList.remove("blocked")}}(e);var i=t;class n{constructor(e,t){this.maxSize=734003200,this.dropArea=e,this.inputFile=document.createElement("input"),this.init(),this.file=null,this.base64=null,this.createMsg=t}init(){this.inputFile.type="file",this.inputFile.accept="audio/*, video/*, image/*",this.inputFile.addEventListener("change",(async e=>{this.file=e.currentTarget.files.item(0),this.validFile()})),this.dropArea.addEventListener("dragover",(e=>e.preventDefault())),this.dropArea.addEventListener("drop",(async e=>{e.preventDefault(),1===e.dataTransfer.files.length&&(this.file=e.dataTransfer.files.item(0),this.validFile())}))}openWindowsChangeFile(){this.file=null,this.inputFile.value="",this.inputFile.click()}get typeFile(){let e;return this.file.type.indexOf("image")>=0?e="img":this.file.type.indexOf("audio")>=0?e="audio":this.file.type.indexOf("video")>=0&&(e="video"),e}async validFile(){this.typeFile&&this.file.size<this.maxSize?this.createMsg(this.file,this.typeFile):(this.file=null,i.showPopup("err","–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫","–†–µ–∑—Ä–µ—à–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã —Ñ–æ—Ä–º–∞—Ç–∞ –∞—É–¥–∏–æ –≤–∏–¥–µ–æ –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ \n –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ 700 MB (734003200 Byte)"))}static readFileToBase64(e){return new Promise((t=>{e||t(null);const s=new FileReader;s.readAsDataURL(e),s.onload=e=>{t(e.target.result)}}))}}const a=()=>{const e=document.getElementById("buttons-start-rec"),t=document.getElementById("buttons-stop-rec");e.classList.remove("hidden"),t.classList.add("hidden")};class o{constructor(e,t){this.popup=e,this.chunks=[],this.recorder=null,this.record=null,this.recordType=void 0,this.recordFormat=void 0,this.duration=0,this.durationString=null,this.timer=null,this.recStatus=!1,this.time=t,this.callbackOK=void 0}clear(){this.chunks=[],this.recorder=null,this.record=null,this.recordType=void 0,this.recordFormat=void 0,this.duration=0,this.durationString=null,this.time.textContent="",this.recStatus=!1,this.callbackOK=void 0}async startRecord(e){try{if(!navigator.mediaDevices){const e="–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫",t="–í–∞—à –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∑–≤—É–∫–∞/–≤–∏–¥–µ–æ";this.popup.showPopup("err",e,t,a)}if(!window.MediaRecorder){const e="–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫",t="–†–∞–∑—Ä–µ—à–∏—Ç–µ –∑–∞–ø–∏—Å—å –∑–≤—É–∫–∞/–≤–∏–¥–µ–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ";this.popup.showPopup("err",e,t,a)}const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:"video"===e});if("video"===e&&document){const e=document.createElement("video");e.controls=!0,e.muted="muted",e.className="mini-video",document.body.appendChild(e),e.srcObject=t,e.play()}this.recorder=new MediaRecorder(t),this.recorder.addEventListener("start",(()=>{this.timer=setInterval((()=>{this.duration+=1;let e=Math.trunc(this.duration/60),t=this.duration-60*e;e<10&&(e=`0${e}`),t<10&&(t=`0${t}`),this.time.textContent=`${e}:${t}`}),1e3),this.recStatus=!0})),this.recorder.addEventListener("dataavailable",(e=>{this.chunks.push(e.data)})),this.recorder.addEventListener("stop",(async()=>{const e=new Blob(this.chunks,{type:`${this.recordType}/${this.recordFormat}`});if(this.record=await n.readFileToBase64(e),t.getTracks().forEach((e=>e.stop())),this.chunks=[],"undefined"!=typeof document){const e=document.getElementsByClassName("mini-video")[0];e&&e.remove()}clearInterval(this.timer),this.duration=0,this.durationString=null,this.recStatus=!1,this.callbackOK()})),this.recorder.start()}catch(e){const t="–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫",s="–†–∞–∑—Ä–µ—à–∏—Ç–µ –∑–∞–ø–∏—Å—å –∑–≤—É–∫–∞/–≤–∏–¥–µ–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ";this.popup.showPopup("err",t,s,a),this.clear()}}async startRecordAudio(){this.recorder||(this.recordType="audio",this.recordFormat="wav",await this.startRecord("audio"))}async startRecordVideo(){this.recorder||(this.recordType="video",this.recordFormat="mp4",await this.startRecord("video"))}async recordOk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};this.callbackOK=e,this.recorder.stop(),this.recorder=null}recordCancel(){this.recorder.stop(),this.clear()}}class r{constructor(e){this.popup=e,this.coords=void 0,this.corrdsText=null,this.address=null}getGeo(){return new Promise(((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((async t=>{this.coords=t.coords,this.coordsText=`[${this.coords.latitude}, ${this.coords.longitude}]`,await this.getPlace(),this.status=!0,e()}),(()=>{this.address="–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",e()})):(this.address="–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",e())}))}async getPlace(){const e=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${this.coords.latitude}&lon=${this.coords.longitude}&zoom=18&addressdetails=1`),{address:t}=await e.json(),{country:s,city:i}=t;this.address=s&&i?`${s}, ${i}`:`–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö <br> [${this.coords.latitude.toFixed(5)}, ${this.coords.longitude.toFixed(5)}]`}}const d=new class{constructor(e){this.url=e,this.contentTypeHeader={"Content-Type":"application/x-www-form-urlencoded"}}async getMessages(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=e.scrollHeight;let i=this.url;t&&(i+=`?id=${t}`);const n=await fetch(i);Array.from(await n.json()).forEach((t=>{const s=new u(t.type,t.msg,t.typeFile,t.extFile);for(const e in t)s[e]=t[e];s.timeStamp=new Date(s.timeStamp),e.prepend(s.html)})),e.scrollTop=t?e.scrollHeight-s:e.scrollHeight}async getPinMsg(e){const t=await fetch(`${this.url}?event=getPinMsg`),s=await t.json();if(s){const t=new u(s.type,s.msg,s.typeFile);for(const e in s)t[e]=s[e];t.timeStamp=new Date(t.timeStamp),e.pinned(t,!1)}}async getFile(e){const t=document.getElementsByClassName("cssload-loading")[0],s=document.getElementsByClassName("container")[0];t.classList.remove("hidden"),s.classList.add("blocked");const i=await fetch(e),n=await i.blob(),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download="YourFile",o.click(),o.remove(),t.classList.add("hidden"),s.classList.remove("blocked")}async pushMessage(e){const t={msg:e.msg,type:e.type,typeFile:e.typeFile,geolocation:e.geolocation,timeStamp:+e.timeStamp},s=new FormData;s.append("msg",JSON.stringify(t)),e.typeFile&&s.append("file",e.msg);const i=await fetch(this.url,{method:"POST",body:s}),n=await i.json();e.id=await n.id,n.msg&&(e.msg=n.msg)}async pinnedMessage(e){const t=new FormData;t.append("id",e);const s=await fetch(this.url,{method:"PATCH",body:t});return"OK"===await s.json()}async unPinnedMessage(){const e=await fetch(this.url,{method:"PATCH"});return"OK"===await e.json()}async deleteMessage(e){const t=`${this.url}?id=${e}`,s=await fetch(t,{method:"DELETE"});return"OK"===await s.json()}downloadBase64File(e,t){const s=e,i=document.createElement("a");document.body.appendChild(i),i.href=s,i.target="_self",i.download=t,i.click()}}("https://ahj-diplom.herokuapp.com/");var c=d;const l=document.getElementById("messages-pin"),h=document.getElementById("messages-list"),p=new class{constructor(e,t){this.id=void 0,this.html=void 0,this.pinArea=e,this.messagesList=t}pinned(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.id)return!1;this.id=e.id,this.html=e.html.cloneNode(!0),this.html.classList.add("pin"),this.html.classList.remove("hidden"),this.html.getElementsByClassName("dell-btn")[0].remove();const s=this.html.getElementsByClassName("pin-btn")[0];return s.classList.remove("hidden"),s.onclick=this.unPinned.bind(this),t&&c.pinnedMessage(this.id),this.pinArea.append(this.html),!0}unPinned(){c.unPinnedMessage();const e=this.messagesList.querySelector(`[data-id="${this.id}"]`);e&&e.classList.remove("hidden"),this.id=void 0,this.html=void 0,this.pinArea.innerHTML=""}}(l,h);var m=p;class u{constructor(e,t,s){this.id=void 0,this.type=e,this.typeFile=s,this.geolocation=void 0,this.timeStamp=new Date,this.msg=t,"text"===this.type&&(this.msgTag=document.createElement("p"),this.msgTag.innerHTML=u.createLink(this.msg)),"audio"!==this.type&&"video"!==this.type||(this.msgTag=document.createElement(this.type),this.msgTag.src=this.msg,this.msgTag.controls=!0),"file"===this.type&&(this.msgTag=document.createElement(this.typeFile),"img"===this.typeFile&&this.msgTag.classList.add("msg-img"),"audio"!==this.typeFile&&"video"!==this.typeFile||(this.msgTag.controls=!0))}get time(){let e=this.timeStamp.getDate(),t=this.timeStamp.getMonth(),s=this.timeStamp.getFullYear(),i=this.timeStamp.getHours(),n=this.timeStamp.getMinutes();return e<10&&(e=`0${e}`),t<10&&(t=`0${t}`),s<10&&(s=`0${s}`),i<10&&(i=`0${i}`),n<10&&(n=`0${n}`),`${e}-${t}-${s}  ${i}:${n}`}get html(){this.typeFile&&(this.msgTag.src=this.msg);const e=this.typeFile?`<a class="download-btn" href="${this.msg}"></a>`:"",t=document.createElement("div");t.classList.add("message"),t.dataset.id=this.id,t.innerHTML=`<div class="msg-header">\n                              <div class="dell-btn hidden">&#10060</div>\n                              <div class="pin-btn hidden">&#x1F4CC</div>\n                              <time>${this.time}</time>\n                            </div>\n                            <div class="msg"></div>\n                            <div class="msg-footer">\n                              <div class="geo__block">\n                                <img class="img-geo" src="geo.png">\n                                <span class= "msg__geo">${this.geolocation}</span>\n                              </div>\n                              ${e}\n                            </div>`,t.querySelector(".msg").append(this.msgTag.cloneNode(!0));const s=t.getElementsByClassName("dell-btn")[0],i=t.getElementsByClassName("pin-btn")[0],n=t.getElementsByClassName("download-btn")[0];return n&&n.addEventListener("click",(async e=>{e.preventDefault(),await c.getFile(this.msg)})),t.addEventListener("mouseover",(()=>{s.classList.remove("hidden"),i.classList.remove("hidden")})),t.addEventListener("mouseout",(()=>{s.classList.add("hidden"),i.classList.add("hidden")})),s.addEventListener("click",(async()=>{await c.deleteMessage(this.id)&&s.closest(".message").remove()})),i.addEventListener("click",(()=>{m.pinned(this)&&t.classList.add("hidden")})),this.id===m.id&&t.classList.add("hidden"),t}getGeolocation(){return this}static createLink(e){const t=e.match(/(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])/gim);return t&&t.forEach((t=>{const s=`<a href="${t}">${t}</a>`;e=e.replace(new RegExp(t,"g"),s)})),e}static async createMessage(e,t,s){const n=new r(i);await n.getGeo();const a=new u(e,t,s);return a.geolocation=n.address,a}}s(903),function(e){if(!e)return;const t=e.getElementById("messages-list"),s=e.getElementById("input"),a=e.getElementById("clip-btn"),r=e.getElementById("audio-start-btn"),d=e.getElementById("video-start-btn"),l=e.getElementById("buttons-start-rec"),h=e.getElementById("buttons-stop-rec"),p=e.getElementById("timer"),g=e.getElementById("ok-btn"),v=e.getElementById("cancel-btn");c.getPinMsg(m),c.getMessages(t);const y=new o(i,p),f=new n(t,(async(e,s)=>{const i=await u.createMessage("file",e,s);await c.pushMessage(i),await t.append(i.html),t.scrollTop=t.scrollHeight}));t.addEventListener("scroll",(()=>{if(0===t.scrollTop){const{id:e}=t.firstChild.dataset;c.getMessages(t,e)}})),r.addEventListener("click",(async()=>{l.classList.add("hidden"),await y.startRecordAudio(),h.classList.remove("hidden")})),d.addEventListener("click",(async()=>{l.classList.add("hidden"),await y.startRecordVideo(),h.classList.remove("hidden")})),g.addEventListener("click",(()=>{l.classList.remove("hidden"),h.classList.add("hidden"),y.recordOk((async()=>{const e=await u.createMessage(y.recordType,y.record);y.clear(),await c.pushMessage(e),t.append(e.html),t.scrollTop=t.scrollHeight}))})),v.addEventListener("click",(()=>{l.classList.remove("hidden"),h.classList.add("hidden"),y.recordCancel()})),s.addEventListener("keydown",(async e=>{if("Enter"!==e.code)return;if(!s.value)return;const i=await u.createMessage("text",e.target.value);await c.pushMessage(i),t.append(i.html),t.scrollTop=t.scrollHeight,e.target.value=null})),a.addEventListener("click",(()=>{f.openWindowsChangeFile()}))}(document)}()}();
//# sourceMappingURL=main.js.map